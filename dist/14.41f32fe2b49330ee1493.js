(window.webpackJsonp=window.webpackJsonp||[]).push([[14,40,41],{"0Pcb":function(t,e,i){"use strict";const s=function(){const t=window.navigator.userAgent;return window.location.href,function(t){const e={},i=t.indexOf("iPhone")>=0||t.indexOf("iPad")>=0||t.indexOf("iPod")>=0,s=t.indexOf("Android")>0;return e.ios=i,e.android=s,e.mobile=i||s,e.pc=!i&&!s,e}(t)}();e.a=s},"JS/M":function(t,e,i){"use strict";i.r(e),i.d(e,"default",function(){return s});class s{constructor(){return this instanceof s?this:new s}isCandidateForCollide(t,e){return t.visible&&e.visible&&t!==e}didCollide(t,e){return console.log(t,e),!1}}},Qb4n:function(t,e,i){"use strict";var s=i("kZAv");e.a=class{constructor(){this.el=document.createElement("canvas")}initCanvasSize(t,e){this.el.width=t,this.el.height=e,this.width=t,this.height=e}getContext(t,e){return this.el.getContext(t,e)}render(t){this.container=t;let{width:e,height:i}=t.getBoundingClientRect();this.initCanvasSize(e||s.d,i||s.b),this.container.innerHTML="",this.container.appendChild(this.el)}}},Vz5x:function(t,e,i){"use strict";i.r(e),i.d(e,"default",function(){return s}),i.d(e,"RectSprite",function(){return l}),i.d(e,"CircleSprite",function(){return r});class s{constructor({type:t,fillStyle:e,name:i="anonymous",visible:s=!1}={}){this.type=t,this.name=i,this.visible=s,this.fillStyle=e}}class l extends s{constructor(t){super(t),this.type="rect",this.left=t.left,this.top=t.top,this.width=t.width,this.height=t.height}}class r extends s{constructor(t){super(t),this.type="circle",this.x=t.x,this.y=t.y,this.radius=t.radius}}},kZAv:function(t,e,i){"use strict";i.d(e,"d",function(){return s}),i.d(e,"b",function(){return l}),i.d(e,"a",function(){return r}),i.d(e,"c",function(){return n});const s=500,l=500,r=`${i("0Pcb").a.pc?24:16}px sans-serif`,n="https://snayan.github.io/canvas-demo/"},xMqE:function(t,e,i){"use strict";i.r(e),i.d(e,"default",function(){return d});var s=i("Qb4n"),l=i("ysz4"),r=i("kZAv"),n=i("0Pcb"),o=i("Vz5x"),h=i("JS/M");class d extends s.a{constructor(){super(),this.rects=[],this.circles=[],this.ctx=this.getContext("2d"),this.isCollide=!1,this.collideColor="rgba(244, 85, 65, 0.8)",this.collide=new h.default}createRect(){let{width:t,height:e,rects:i}=this,s=["rgba(66, 134, 244, 0.5)","rgba(65, 244, 223, 0.5)"],r=i=>{let r=Math.min(Math.min(t,e)/5,100);r+=r/4*i;let n=Math.floor(Object(l.d)(0,t)),h=Math.floor(Object(l.d)(0,e));return n+r>t&&(n-=r),h+r>e&&(h-=r),new o.RectSprite({name:`rect_${i}`,left:n,top:h,width:r,height:r,fillStyle:s[i%2],visible:!0})};for(let t=0,e=2;t<e;t++){do{this.draggingSprite=r(t),this.didCollide()}while(this.isCollide);i[t]=this.draggingSprite,this.draggingSprite=null}}createCircle(){let{width:t,height:e,circles:i}=this,s=["rgba(244, 235, 65, 0.5)","rgba(66, 244, 86,0.5)"],r=Math.min(Math.min(t,e)/10,50),n=i=>{let n=Math.floor(Object(l.d)(r,t)),h=Math.floor(Object(l.d)(r,e));return n+r>t&&(n-=r),h+r>e&&(h-=r),new o.CircleSprite({name:`circle_${i}`,x:n,y:h,radius:r,fillStyle:s[i%2],visible:!0})};for(let t=0,e=2;t<e;t++){do{this.draggingSprite=n(t),this.didCollide()}while(this.isCollide);i[t]=this.draggingSprite,this.draggingSprite=null}}drawTitle(){let{ctx:t,width:e,height:i,isCollide:s,collideColor:l}=this;t.save(),t.font=r.a,t.textAlign="center",t.fillStyle=s?l:"rgba(66, 134, 244, 0.8)";let n=t.measureText("M").width;t.fillText(s?"碰撞了":"碰撞检测：外接图形法",e/2,n+n/6+10),t.restore()}drawRect(){let{ctx:t,rects:e,draggingSprite:i}=this;t.save();for(let[s,{left:l,top:r,width:n,height:o,fillStyle:h,visible:d}]of e.entries())d&&e[s]!==i&&(t.fillStyle=h,t.beginPath(),t.rect(l,r,n,o),t.fill());t.restore()}drawCircle(){let{circles:t,ctx:e,draggingSprite:i}=this;e.save();for(let[s,{fillStyle:l,visible:r,x:n,y:o,radius:h}]of t.entries())r&&t[s]!==i&&(e.fillStyle=l,e.beginPath(),e.arc(n,o,h,0,2*Math.PI,!1),e.fill())}drawDraggingSprite(){let{ctx:t,draggingSprite:e}=this;if(this.draggingSprite){if(t.save(),t.fillStyle=e.fillStyle,t.beginPath(),"rect"===e.type){let{left:i,top:s,width:l,height:r}=e;t.rect(i,s,l,r)}else{let{x:i,y:s,radius:l}=e;t.arc(i,s,l,0,2*Math.PI,!1)}t.fill(),t.restore()}}drawCollideTip(){let{ctx:t,isCollide:e,collideColor:i,width:s,height:l}=this;e&&(t.save(),t.strokeStyle=i,t.lineWidth=10,t.strokeRect(0,0,s,l),t.restore())}bindEvent(){let{width:t,height:e,el:i}=this,s=t=>e=>t.call(this,(t=>{let e,i;return t.preventDefault(),n.a.pc?(e=t.x,i=t.y):(e=t.touches[0].pageX,i=t.touches[0].pageY),{ex:e,ey:i}})(e));n.a.pc?(i.addEventListener("mousedown",s(this.mouseDown),!1),i.addEventListener("mousemove",s(this.mouseMove),!1),i.addEventListener("mouseup",this.mouseUp.bind(this),!1),i.addEventListener("mouseleave",this.mouseUp.bind(this),!1)):(i.addEventListener("touchstart",s(this.mouseDown),!1),i.addEventListener("touchmove",s(this.mouseMove),!1),i.addEventListener("touchend",this.mouseUp.bind(this),!1),i.addEventListener("touchcancel",this.mouseUp.bind(this),!1))}mouseDown({ex:t,ey:e}){let{el:i,ctx:s,rects:r,circles:n}=this,{x:o,y:h}=Object(l.h)(i,t,e);for(let[t,{left:e,top:i,width:l,height:n,visible:d}]of r.entries())if(d&&(s.beginPath(),s.rect(e,i,l,n),s.isPointInPath(o,h))){this.draggingSprite=r[t],this.lastMovePoint={left:o,top:h};break}if(!this.draggingSprite)for(let t of n)if(t.visible&&(s.beginPath(),s.arc(t.x,t.y,t.radius,0,2*Math.PI,!1),s.isPointInPath(o,h))){this.draggingSprite=t,this.lastMovePoint={left:o,top:h};break}}mouseMove({ex:t,ey:e}){let{el:i,ctx:s,collide:r,rects:n,draggingSprite:o,width:h,height:d,lastMovePoint:a}=this,{x:c,y:u}=Object(l.h)(i,t,e);o&&("rect"===o.type?this.moveRect(o,c,u):"circle"===o.type&&this.moveCircle(o,c,u),this.lastMovePoint={left:c,top:u},this.didCollide(),this.draw())}mouseUp(){this.draggingSprite=null,this.lastMovePoint=null}moveRect(t,e,i){let{width:s,height:l,lastMovePoint:r}=this;t.left+=e-r.left,t.top+=i-r.top,t.left=Math.max(0,t.left),t.left=Math.min(s-t.width,t.left),t.top=Math.max(0,t.top),t.top=Math.min(l-t.height,t.top)}moveCircle(t,e,i){let{width:s,height:l,lastMovePoint:r}=this;t.x+=e-r.left,t.y+=i-r.top,t.x=Math.max(t.radius,t.x),t.x=Math.min(s-t.radius,t.x),t.y=Math.max(t.radius,t.y),t.y=Math.min(l-t.radius,t.y)}didCollide(){let{rects:t,circles:e,draggingSprite:i,collide:s}=this;if(this.isCollide=!1,i){for(let e of t)s.isCandidateForCollide(i,e)&&s.didCollide(i,e)&&(this.isCollide=!0,console.log(`occur collide: ${i.name} and ${e.name}`));for(let t of e)s.isCandidateForCollide(i,t)&&s.didCollide(i,t)&&(this.isCollide=!0,console.log(`occur collide: ${i.name} and ${t.name}`))}}draw(){let{ctx:t,width:e,height:i}=this;t.clearRect(0,0,e,i),this.drawTitle(),this.drawRect(),this.drawCircle(),this.drawDraggingSprite(),this.drawCollideTip()}render(t){super.render(t),this.createRect(),this.createCircle(),this.draw(),this.bindEvent()}}}}]);